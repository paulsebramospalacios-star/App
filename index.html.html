<!DOCTYPE html>

<html lang="es">

<head>

  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <meta name="theme-color" content="#f7fafc" media="(prefers-color-scheme: light)">

  <meta name="theme-color" content="#0b1020" media="(prefers-color-scheme: dark)">
  
  <link rel="manifest" href="manifest.json">

  <meta name="theme-color" content="#0b1020">

  <title>Reporte Incidentes ¬∑ App M√≥vil</title>

  <style>

    :root{

      --inicio-color:#e03131;

      --act-color:#1c7ed6;

      --fin-color:#2f9e44;

      --bg:#ffffff;

      --panel:#ffffff;

      --text:#1f2937;

      --muted:#6b7280;

      --border:rgba(0,0,0,.08);

      --accent:#22c55e;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;

      --vh: 100vh; /* actualizado v√≠a JS para m√≥viles */

    }

    *{box-sizing:border-box}

    html,body{height:100%;}

    body{

      margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;

      color:var(--text); background: linear-gradient(180deg,#f7fafc,#eaeef5);

    }

 

    /* App shell */

    .app{min-height:calc(var(--vh) - env(safe-area-inset-bottom)); display:flex; flex-direction:column}

    .app__header{position:sticky; top:0; z-index:10; backdrop-filter:saturate(120%) blur(8px);

      background:rgba(255,255,255,.7); color:#111827; padding:12px 16px calc(12px + env(safe-area-inset-top));

      border-bottom:1px solid var(--border)}

    .title{margin:4px 0 0; font-weight:800; font-size:18px; letter-spacing:.2px}

    .subtitle{margin:2px 0 0; color:var(--muted); font-size:12px}

 

    .app__content{flex:1; display:flex; gap:14px; padding:14px; padding-bottom:96px;}

    @media (min-width: 980px){ .app__content{gap:20px; padding:20px; padding-bottom:120px;} }

 

    .col{display:flex; flex-direction:column; gap:14px; width:100%}

    .panel{background:var(--panel); border:1px solid var(--border); border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.25)}

    .panel__head{padding:12px 14px; border-bottom:1px solid var(--border); font-weight:700}

    .panel__body{padding:14px}

 

    /* Form fields */

    .row{display:flex; gap:10px; margin-bottom:12px}

    .row label{min-width:150px; font-weight:700}

    .row input[type=text], .row textarea, .row select{

      flex:1; padding:14px 14px; border:1px solid var(--border); border-radius:12px; background:#ffffff; color:var(--text); font-size:16px

    }

    .row textarea{min-height:88px; resize:vertical}

 

    /* Multil√≠nea apilada */

    .row.stack{flex-direction:column; align-items:stretch}

    .row.stack label{min-width:unset}

    #servicios, #descripcion, #acciones{ min-height:44px; font-family:var(--mono); line-height:1.4; white-space:pre; overflow:auto }

 

    /* Mobile-first */

    @media (max-width: 768px){

      .app__content{flex-direction:column}

      .row{flex-direction:column}

      .row label{min-width:unset}

      #servicios, #descripcion, #acciones{ min-height:72px; white-space:pre-wrap; overflow-y:auto; overflow-x:hidden }

      .panel__body{padding:12px}

    }

 

    /* Preview styles */

    .badge{display:inline-flex; align-items:center; gap:8px; font-weight:800; padding:8px 12px; border-radius:999px; color:#fff}

    .card{background:#ffffff; border:1px solid var(--border); border-radius:16px; padding:16px; line-height:1.45}

    .section{margin-top:10px}

    .k{font-weight:900}

    .muted{color:var(--muted)}

    .code{white-space:pre-wrap; font-family:var(--mono); font-size:13px; background:#f3f4f6; color:#111827; border:1px solid var(--border); border-radius:12px; padding:12px; margin-top:12px}

 

    /* Bottom action bar */

    .actionbar{position:fixed; left:0; right:0; bottom:0; z-index:15; display:flex; gap:10px; padding:12px; padding-bottom:calc(12px + env(safe-area-inset-bottom));

      background:linear-gradient(180deg, rgba(255,255,255,0), rgba(229,231,235,.9) 30%);}

    .btn{appearance:none; -webkit-appearance:none; border:0; border-radius:14px; padding:16px 18px; font-weight:900; font-size:16px; letter-spacing:.2px; cursor:pointer}

    .btn.primary{background:#16a34a; color:#051b0f}

    .btn.secondary{background:#334155; color:#e5e7eb}

    .btn.warn{background:#ef4444; color:#fff}

    .btn:active{transform:translateY(1px)}

    @media (max-width: 600px){ .btn{font-size:18px; padding:18px 20px} }

 

    /* ========= Modal / Vista previa Informe SB ========= */

    .modal-backdrop{

      position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; z-index:50;

      align-items:center; justify-content:center; padding:18px;

    }

    .modal{background:#fff; border-radius:16px; width:min(100%, 980px); max-height:90vh; overflow:auto; box-shadow:0 25px 80px rgba(0,0,0,.35);}

    .modal__head{position:sticky; top:0; background:#f8fafc; border-bottom:1px solid var(--border); padding:12px 16px; display:flex; gap:10px; align-items:center; justify-content:space-between}

    .modal__title{font-weight:800}

    .modal__body{padding:16px; background:#edf2f7}

    .paper{

      width:794px; /* aprox A4 @96dpi */

      margin:0 auto; background:#fff; color:#111; border:1px solid #d1d5db; padding:24px;

      box-shadow:0 10px 30px rgba(0,0,0,.08)

    }

    .sb-p{margin:0 0 10px; font-size:12px}

    .sb-table{width:100%; border-collapse:collapse; font-size:12px}

    .sb-table th, .sb-table td{border:1px solid #9ca3af; padding:8px; vertical-align:top}

    .sb-table thead th{background:#e5edf6; text-align:center; font-weight:800}

    .sb-rowtitle{width:30%; background:#f3f4f6; font-weight:700}

    .sb-small{font-size:11px; color:#374151}

    .sb-ul{margin:6px 0 0 18px}

    .sb-ul li{margin:4px 0}

  </style>

</head>

<body>

  <div class="app">

    <header class="app__header">

      <div>üîß <strong>Reporte Incidentes</strong></div>

      <h1 class="title">App M√≥vil</h1>

      <div class="subtitle">Paul Ramos</div>

    </header>

 

    <main class="app__content">

      <section class="col">

        <div class="panel">

          <div class="panel__head">‚öôÔ∏è Configuraci√≥n</div>

          <div class="panel__body">

            <div class="row">

              <label for="tipo">Tipo de mensaje</label>

              <select id="tipo">

                <option value="inicio">üî¥ Inicio Incidente</option>

                <option value="actualizacion">üîÑ Actualizaci√≥n Incidente</option>

                <option value="fin">‚úÖ Fin Incidente</option>

              </select>

            </div>

 

            <div class="row stack">

              <label for="servicios">Servicios afectados</label>

              <textarea id="servicios" placeholder="Ej.: Pagos de servicios y recargas celulares"></textarea>

            </div>

 

            <div class="row stack">

              <label for="descripcion">Descripci√≥n de la afectaci√≥n</label>

              <textarea id="descripcion" placeholder="Describe brevemente la afectaci√≥n"></textarea>

            </div>

 

            <div class="row stack">

              <label for="acciones">Acciones</label>

              <textarea id="acciones" placeholder="- Acci√≥n 1

- Acci√≥n 2

- ‚Ä¶"></textarea>

            </div>

 

            <div class="row">

              <label for="ticket">Ticket</label>

              <input id="ticket" type="text" placeholder="Ej.: INC0031327" />

            </div>

 

            <div class="row">

              <label for="horaInicio">Hora de inicio</label>

              <input id="horaInicio" type="text" placeholder="Ej.: 7h12" />

            </div>

 

            <div class="row" id="rowHoraFin" style="display:none">

              <label for="horaFin">Hora de fin</label>

              <input id="horaFin" type="text" placeholder="Ej.: 8h28" />

            </div>

 

            <div class="row">

              <label for="estado">Estado</label>

              <select id="estado">

                <option value="en-curso">En curso</option>

                <option value="cerrado">Cerrado</option>

              </select>

            </div>

          </div>

        </div>

      </section>

 

      <section class="col">

        <div class="panel">

          <div class="panel__head">üëÅÔ∏è Vista previa</div>

          <div class="panel__body">

            <div id="badge" class="badge" style="background:var(--inicio-color)">üî¥ <small>Inicio Incidente</small></div>

            <div class="card">

              <div class="section"><span class="k">*Servicios afectados*:</span> <span id="vServicios" class="muted">‚Äî</span></div>

              <div class="section"><span class="k">*Descripci√≥n Afectaci√≥n*:</span><div id="vDescripcion" class="muted">‚Äî</div></div>

              <div class="section"><span class="k"># *Ticket*:</span> <span id="vTicket" class="muted">‚Äî</span></div>

              <div class="section"><span class="k">‚öíÔ∏è *Acciones*:</span><div id="vAcciones" class="muted" style="margin-top:6px">‚Äî</div></div>

              <div class="section">

                <div>üïí <span class="k">*Hora de inicio*:</span> <span id="vInicio" class="muted">‚Äî</span></div>

                <div id="vFinRow" style="display:none">üïí <span class="k">*Hora de fin*:</span> <span id="vFin" class="muted">‚Äî</span></div>

              </div>

              <div class="section">üìå <span class="k">*Estado*:</span> <span id="vEstado" class="muted">En curso</span></div>

            </div>

            <div class="code" id="salidaPlano"></div>

          </div>

        </div>

      </section>

    </main>

 

    <footer class="actionbar">

      <button class="btn secondary" id="btnCopiar">üìã Copiar</button>

      <button class="btn primary" id="btnReset">‚Ü∫ Limpiar</button>

      <button class="btn warn" id="btnInformeSB" title="Generar vista previa del informe para la SB">üìÑ InformeSB</button>

    </footer>

  </div>

 

  <!-- ===== Modal de vista previa del Informe SB (solo vista) ===== -->

  <div class="modal-backdrop" id="modalInforme">

    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="ttlModal">

      <div class="modal__head">

        <div class="modal__title" id="ttlModal">Vista previa ¬∑ Informe a la Superintendencia de Bancos</div>

        <div style="display:flex; gap:8px">

          <!-- Solo cierre (sin imprimir ni copiar) -->

          <button class="btn primary" id="btnCerrarInforme">Cerrar</button>

        </div>

      </div>

      <div class="modal__body">

        <div id="informeContainer" class="paper" aria-label="Documento A4 de vista previa"></div>

      </div>

    </div>

  </div>

 

  <script>

    // Fix 100vh en m√≥viles

    const setVh = () =>{ document.documentElement.style.setProperty('--vh', window.innerHeight + 'px') };

    window.addEventListener('resize', setVh); setVh();

 

    // Controles

    const tipo = document.getElementById('tipo');

    const servicios = document.getElementById('servicios');

    const descripcion = document.getElementById('descripcion');

    const acciones = document.getElementById('acciones');

    const ticket = document.getElementById('ticket');

    const horaInicio = document.getElementById('horaInicio');

    const horaFin = document.getElementById('horaFin');

    const rowHoraFin = document.getElementById('rowHoraFin');

    const estado = document.getElementById('estado');

 

    // Vista previa r√°pida

    const badge = document.getElementById('badge');

    const vServicios = document.getElementById('vServicios');

    const vDescripcion = document.getElementById('vDescripcion');

    const vAcciones = document.getElementById('vAcciones');

    const vTicket = document.getElementById('vTicket');

    const vInicio = document.getElementById('vInicio');

    const vFin = document.getElementById('vFin');

    const vFinRow = document.getElementById('vFinRow');

    const vEstado = document.getElementById('vEstado');

    const salidaPlano = document.getElementById('salidaPlano');

 

    // Botones inferiores

    const btnCopiar = document.getElementById('btnCopiar');

    const btnReset = document.getElementById('btnReset');

    const btnInformeSB = document.getElementById('btnInformeSB');

 

    // Modal SB

    const modal = document.getElementById('modalInforme');

    const informeContainer = document.getElementById('informeContainer');

    const btnCerrarInforme = document.getElementById('btnCerrarInforme');

 

    const presets = {

      inicio: { icon:'üî¥', title:'Inicio Incidente', color:'var(--inicio-color)', showFin:false, estadoFix:'en-curso', notif:'Inicial' },

      actualizacion: { icon:'üîÑ', title:'Actualizaci√≥n Incidente', color:'var(--act-color)', showFin:false, estadoFix:'en-curso', notif:'Actualizaci√≥n' },

      fin: { icon:'‚úÖ', title:'Fin Incidente', color:'var(--fin-color)', showFin:true, estadoFix:'cerrado', notif:'Cierre' }

    };

 

    function sanitizeLines(text){

      return (text || '').split(/\r?\n/).map(l=>l.trim()).filter(l=>l.length>0).join('\n');

    }

    function linesArray(text){

      return (text || '').split(/\r?\n/).map(l=>l.trim()).filter(l=>l.length>0);

    }

    function pad(n){return String(n).padStart(2,'0')}

    function formatTodayHHMM(){

      const d = new Date();

      const yy = String(d.getFullYear()).slice(-2);

      return `${pad(d.getDate())}/${pad(d.getMonth()+1)}/${yy} ${pad(d.getHours())}:${pad(d.getMinutes())}`;

    }

 

    function update(){

      const p = presets[tipo.value];

      badge.style.background = p.color;

      badge.innerHTML = `${p.icon} <small>${p.title}</small>`;

      rowHoraFin.style.display = p.showFin ? '' : 'none';

      vFinRow.style.display = p.showFin ? '' : 'none';

      if(p.estadoFix){ estado.value = p.estadoFix; }

 

      vServicios.textContent = servicios.value.trim() || '‚Äî';

      vDescripcion.textContent = sanitizeLines(descripcion.value || '');

      vAcciones.textContent = sanitizeLines(acciones.value || '');

      vTicket.textContent = ticket.value.trim() || '‚Äî';

      vInicio.textContent = horaInicio.value.trim() || '‚Äî';

      vFin.textContent = horaFin.value.trim() || '‚Äî';

      vEstado.textContent = estado.options[estado.selectedIndex].text;

      buildPlain();

    }

 

    function buildPlain(){

      const p = presets[tipo.value];

      const lines = [];

      lines.push(`${p.icon} *${p.title}:*`);

      lines.push(`*Servicios afectados* :`);

      lines.push(`${servicios.value.trim()}`);

      lines.push('');

      lines.push(`*Descripci√≥n Afectaci√≥n:*`);

      lines.push(`${sanitizeLines(descripcion.value)}`);

      lines.push('');

      lines.push(`# *Ticket:* ${ticket.value.trim()}`);

      lines.push('‚öíÔ∏è *Acciones:*');

      lines.push(`${sanitizeLines(acciones.value)}`);

      lines.push('');

      lines.push(`üïí *Hora de inicio:* ${horaInicio.value.trim()}`);

      if(p.showFin){ lines.push(`üïí *Hora de fin:* ${horaFin.value.trim()}`); }

      lines.push('');

      lines.push(`üìå *Estado:* ${estado.options[estado.selectedIndex].text}`);

      salidaPlano.textContent = lines.join('\n');

    }

 

    [tipo, servicios, descripcion, acciones, ticket, horaInicio, horaFin, estado]

      .forEach(el=> el.addEventListener('input', update));

 

btnCopiar.addEventListener('click', async () => {
  try {
    // Intento moderno
    await navigator.clipboard.writeText(salidaPlano.textContent);
    btnCopiar.textContent = '‚úÖ Copiado';
  } catch (err) {
    // Fallback para m√≥viles Android
    const temp = document.createElement("textarea");
    temp.value = salidaPlano.textContent;
    document.body.appendChild(temp);
    temp.select();
    temp.setSelectionRange(0, temp.value.length); // necesario en m√≥viles
    try {
      document.execCommand("copy");
      btnCopiar.textContent = '‚úÖ Copiado';
    } catch (err2) {
      alert("No se pudo copiar autom√°ticamente. Selecciona y copia manualmente.");
    }
    document.body.removeChild(temp);
  }
  setTimeout(() => btnCopiar.textContent = 'üìã Copiar', 1200);
});

 

    btnReset.addEventListener('click', ()=>{

      servicios.value = '';

      descripcion.value = '';

      acciones.value = '';

      ticket.value = '';

      horaInicio.value = '';

      horaFin.value = '';

      tipo.value = 'inicio';

      estado.value = 'en-curso';

      update();

    });

 

    /* ======================= Informe SB (solo vista previa) ======================= */

    const canalMap = [

      {code:'C', desc:'Cajeros autom√°ticos', keys:['cajero', 'atm']},

      {code:'I', desc:'Internet', keys:['internet', 'web']},

      {code:'O', desc:'Oficina', keys:['oficina', 'agencia', 'sucursal']},

      {code:'F', desc:'Banca telef√≥nica', keys:['telefon', 'call center']},

      {code:'K', desc:'Terminal de autoservicio ‚Äì kiosco', keys:['kiosco','kiosko','autoservicio']},

      {code:'M', desc:'Banca celular', keys:['banca celular']},

      {code:'T', desc:'Tarjeta de d√©bito POS', keys:['debito','d√©bito','pos']},

      {code:'D', desc:'Tarjeta de cr√©dito POS', keys:['credito','cr√©dito']},

      {code:'N', desc:'Corresponsales No Bancarios', keys:['corresponsal']},

      {code:'V', desc:'Visitas', keys:['visita']},

      {code:'P', desc:'Tarjeta prepago POS', keys:['prepago']},

      {code:'E', desc:'Ventanillas de otra entidad', keys:['ventanilla', 'otra entidad']},

      {code:'X', desc:'Entidades de servicios auxiliares del Sistema Financiero', keys:['banred','auxiliar','servicio auxiliar']},

      {code:'U', desc:'Plataforma de pagos m√≥viles', keys:['app','m√≥vil','movil','pagos','recargas','celular','billetera','pago m√≥vil']}

    ];

 

    function canalesMarcados(textServicios){

      const s = (textServicios || '').toLowerCase();

      const set = new Set();

      canalMap.forEach(c=>{

        if(c.keys.some(k=> s.includes(k))) set.add(c.code);

      });

      return set;

    }

 

    function buildTablaCanalesHTML(markedSet){

      const rows = canalMap.map(c=>{

        const mark = markedSet.has(c.code) ? 'X' : '';

        return `<tr><td style="text-align:center; font-weight:800">${c.code}</td><td>${c.desc}</td><td style="text-align:center">${mark}</td></tr>`;

      }).join('');

      return `

        <table class="sb-table" aria-label="Canales de atenci√≥n al p√∫blico afectados">

          <thead>

            <tr><th style="width:15%">CODIGO</th><th>DESCRIPCION ‚Äì TIPO CANALES</th><th style="width:20%">Canal Afectado BP (x):</th></tr>

          </thead>

          <tbody>${rows}</tbody>

        </table>

      `;

    }

 

    function buildBulletListHTML(lines){

      if(!lines || lines.length===0) return '<div class="sb-small">N/A</div>';

      return `<ul class="sb-ul">${lines.map(li=>`<li>${li}</li>`).join('')}</ul>`;

    }

 

    function buildInformeSBHTML(){

      const p = presets[tipo.value];

      const notif = p.notif;

      const criticidad = 'P3'; // ajusta si agregas este campo al formulario

      const hoy = formatTodayHHMM().split(' ')[0];

      const fechaHoraInicio = `${hoy} ${horaInicio.value.trim() || ''}`.trim();

 

      const serviciosText = servicios.value.trim();

      const descLines = linesArray(descripcion.value);

      const accLines = linesArray(acciones.value);

      const marked = canalesMarcados(serviciosText);

      const tablaCanales = buildTablaCanalesHTML(marked);

 

      return `

        <div>

          <div class="sb-p" style="font-weight:800">Estimados Sres.<br>Superintendencia de Bancos</div>

          <div class="sb-p">Se adjunta detalle de incidente <span style="font-weight:800">${ticket.value.trim() || '‚Äî'}</span> ${criticidad}</div>

 

          <table class="sb-table" style="margin-top:10px">

            <tbody>

              <tr>

                <td class="sb-rowtitle">Tipo de Notificaci√≥n:</td>

                <td>${notif}</td>

              </tr>

              <tr>

                <td class="sb-rowtitle">Fecha y Hora de Inicio del Incidente:</td>

                <td><ul class="sb-ul"><li>${fechaHoraInicio || '‚Äî'}</li></ul></td>

              </tr>

              <tr>

                <td class="sb-rowtitle">Nivel de Criticidad:</td>

                <td>${criticidad}</td>

              </tr>

              <tr>

                <td class="sb-rowtitle">Canales de atenci√≥n al p√∫blico afectados:</td>

                <td>${tablaCanales}</td>

              </tr>

            </tbody>

          </table>

 

          <table class="sb-table" style="margin-top:12px">

            <tbody>

              <tr>

                <td class="sb-rowtitle">Descripci√≥n del incidente (indisponibilidad o afectaci√≥n):</td>

                <td>${buildBulletListHTML(descLines.length ? descLines : linesArray(serviciosText))}</td>

              </tr>

              <tr>

                <td class="sb-rowtitle">Componentes tecnol√≥gicos afectados:</td>

                <td>${buildBulletListHTML([])}</td>

              </tr>

              <tr>

                <td class="sb-rowtitle">Acciones de investigaci√≥n/diagn√≥stico/recuperaci√≥n:</td>

                <td>${buildBulletListHTML(accLines)}</td>

              </tr>

              <tr>

                <td class="sb-rowtitle">Planes de contingencia implementados:</td>

                <td><div class="sb-small">N/A</div></td>

              </tr>

            </tbody>

          </table>

        </div>

      `;

    }

 

    function abrirModalInforme(){

      informeContainer.innerHTML = buildInformeSBHTML();

      modal.style.display = 'flex';

      setTimeout(()=>btnCerrarInforme.focus(), 50);

    }

    function cerrarModalInforme(){ modal.style.display = 'none' }

 

    btnInformeSB.addEventListener('click', abrirModalInforme);

    btnCerrarInforme.addEventListener('click', cerrarModalInforme);

    modal.addEventListener('click', (e)=>{ if(e.target === modal) cerrarModalInforme(); });

    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && modal.style.display==='flex') cerrarModalInforme(); });

 

    // Seed sample (puedes borrar estas l√≠neas)

    servicios.value = 'Pagos de servicios y recargas celulares';

    descripcion.value = '- Afectaci√≥n en pagos de servicios y recargas celulares';

    acciones.value = '- Se verifica que no se tiene fondos en la cuenta de BP que fondea a Banred.\n- 7h40 se deshabilita la funcionalidad de pagos a servicios y recargas celulares';

    ticket.value = 'INC0031327';

    horaInicio.value = '7h12';

    update();

  </script>
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js")
      .then(() => console.log("Service Worker registrado"))
      .catch(err => console.error("Error al registrar SW:", err));
  }
</script>

</body>

</html>